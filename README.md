# 自動株式バックテストシステム

## 📊 GitHub Pages レポート

### メインダッシュボード
```
https://yuukisabu0310.github.io/auto-stock-backtest2/
```

### 個別レポートへのアクセス
- **スイングトレード戦略**: `https://yuukisabu0310.github.io/auto-stock-backtest2/スイングトレード_YYYYMMDD_HHMMSS.html`
- **中長期投資戦略**: `https://yuukisabu0310.github.io/auto-stock-backtest2/中長期投資_YYYYMMDD_HHMMSS.html`
- **対象銘柄一覧**: `https://yuukisabu0310.github.io/auto-stock-backtest2/swing_trading_stocks_YYYYMMDD_HHMMSS.html`

### 最新レポート例
- [スイングトレード最新レポート](https://yuukisabu0310.github.io/auto-stock-backtest2/スイングトレード_20250831_210336.html)
- [対象銘柄一覧](https://yuukisabu0310.github.io/auto-stock-backtest2/swing_trading_stocks_20250831_210334.html)

## 🚀 概要

自動株式バックテストシステム（指数別ランダム抽出版）は、S&P500、NASDAQ100、日経225の銘柄を使用して、複数の投資戦略のバックテストを自動実行し、結果をレポート化するシステムです。

## 📈 特徴

- **指数別ランダム抽出**: SP500、NASDAQ100、日経225からランダムに銘柄を選択
- **複数戦略対応**: スイングトレード、中長期投資戦略
- **複数回実行**: 統計的有意性を確保するため複数回実行
- **結果集計**: 複数回の結果を集計して平均性能を算出
- **自動レポート生成**: HTML形式で詳細なレポートを自動生成
- **差分データ取得**: 効率的なデータ取得でAPI負荷を軽減

## 🎯 戦略

### スイングトレード戦略
- **対象銘柄数**: 100銘柄（各指数からランダム抽出）
- **最大保有銘柄数**: 15銘柄（システムトレード向け）
- **バックテスト期間**: 実行日の前月末日から過去5年
- **時間枠**: 日次データ
- **特徴**: 短期の価格変動を活用

### 中長期投資戦略
- **対象銘柄数**: 200銘柄（各指数からランダム抽出）
- **最大保有銘柄数**: 25銘柄（システムトレード向け）
- **バックテスト期間**: 実行日の前月末日から過去20年
- **時間枠**: 日次データ
- **特徴**: 長期の成長トレンドを活用

## 📊 データソース

- **主要データソース**: stooq.com
- **データ取得期間**: 2004年12月31日 〜 2024年12月31日（マスタデータ）
- **バックテスト期間**: 動的計算（実行日の前月末日から過去N年）
- **データ形式**: 日次株価データ + VIX（恐怖指数）

## 🔧 技術仕様

- **Python 3.9**
- **主要ライブラリ**: pandas, numpy, plotly, pandas-datareader
- **自動実行**: GitHub Actions（毎日06:00 JST）
- **レポート**: HTML + Plotly（インタラクティブチャート）

## 📁 ファイル構成

```
auto-stock-backtest2/
├── main.py                 # メインスクリプト（従来版）
├── main_parallel.py        # 並列化メインスクリプト
├── data_loader.py          # データ取得・管理
├── data_fetcher.py         # データ取得専用クラス
├── cache_data_loader.py    # キャッシュ専用データローダー
├── backtest_engine.py      # バックテストエンジン
├── report_generator.py     # レポート生成
├── backtest_aggregator.py  # 結果集計
├── config.py              # 設定ファイル
├── index_stocks.csv       # 銘柄リスト
├── cache/                 # 株価データキャッシュ
├── reports/               # 生成レポート
├── results/               # バックテスト結果
└── logs/                  # ログファイル
```

## 🚀 使用方法

### 1. 環境セットアップ
```bash
pip install -r requirements.txt
```

### 2. 並列化バックテスト実行（推奨）
```bash
# データ取得とバックテストを分離実行
python main_parallel.py --data-only --num-runs 1
python main_parallel.py --cache-only --num-runs 3

# または一括実行
python main_parallel.py --parallel --num-runs 3
```

### 3. 従来のバックテスト実行
```bash
python main.py --num-runs 5 --base-seed 42
```

### 4. 特定戦略のみ実行
```bash
python main_parallel.py --strategy swing_trading --num-runs 3
```

## 📈 レポート内容

### パフォーマンス指標
- 総リターン
- シャープレシオ
- 最大ドローダウン
- 勝率
- 取引回数

### チャート
- エクイティカーブ
- 月次リターン
- ドローダウン推移
- VIX（恐怖指数）
- 取引履歴

### 戦略条件
- エントリー条件
- エグジット条件
- リスク管理設定

## 🔄 自動実行

### GitHub Actions設定
- **データ取得**: 毎日06:00 JST（UTC時間21:00前日）
- **バックテスト**: 毎日06:30 JST（UTC時間21:30前日）
- **実行内容**: データ取得 → バックテスト（3回実行）
- **自動デプロイ**: レポートの自動更新

### データ取得とバックテスト分離
- **データ取得フェーズ**: 全銘柄のマスタデータを取得・キャッシュ
- **バックテストフェーズ**: キャッシュから動的期間でデータをスライス
- **並列実行**: 戦略別の並列バックテスト実行
- **エラー対応**: stooq.comエラーを考慮した毎日データ取得

## 📊 結果の解釈

### 統計的有意性
- 複数回実行による平均性能
- 標準偏差によるリスク評価
- 信頼区間の算出

### 戦略比較
- リターン比較
- リスク調整後リターン
- ドローダウン比較

## 🔧 カスタマイズ

### 戦略パラメータ変更
`config.py`の`TRADING_RULES`を編集

### 銘柄リスト更新
```bash
python update_stocks.py
```

### 期間変更
バックテスト期間は動的に計算されます（実行日の前月末日から過去N年）
- スイングトレード: 過去5年
- 中長期投資: 過去20年

## 📝 注意事項

- VIXが30以上の場合、取引を停止する安全機能を搭載
- 無料APIの制限により、差分データ取得を採用
- 過去の結果は将来の保証ではありません
- データ取得エラー時は翌日自動リトライ

## 🤝 貢献

バグ報告や機能要望は、GitHubのIssuesでお知らせください。

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。  

## 🚀 パフォーマンス向上機能

### 並列処理による高速化

システムは並列処理を活用してデータ取得とバックテストの高速化を実現しています。

#### 主な改善点

1. **データ取得とバックテスト分離**
   - データ取得フェーズとバックテストフェーズを完全分離
   - マスタデータの事前取得とキャッシュ
   - 動的期間でのデータスライス

2. **並列戦略実行**
   - 複数戦略の並列バックテスト実行
   - キャッシュ専用モードでの高速実行
   - 戦略間の独立性確保

3. **動的期間計算**
   - 実行日の前月末日から過去N年を自動計算
   - 常に最新の期間でバックテスト実行
   - 手動設定不要

#### パフォーマンステスト

高速化効果を測定するパフォーマンステストスクリプトを実行できます：

```bash
python performance_test.py
```

**期待される改善効果：**
- データ取得: **安定化**（毎日実行によるエラー対応）
- バックテスト: **3-5倍**の高速化（キャッシュ専用モード）
- 全体処理: **2-4倍**の高速化（並列実行）

#### 並列処理の制御

`config.py`で並列処理の設定を調整できます：

```python
# パフォーマンス設定
MAX_WORKERS = 5  # 並列処理の最大ワーカー数
BATCH_SIZE = 10  # バッチ処理のサイズ
CACHE_ENABLED = True  # キャッシュの有効/無効
```

#### 使用例

```bash
# データ取得のみ実行
python main_parallel.py --data-only --num-runs 1

# キャッシュ専用バックテスト（高速）
python main_parallel.py --cache-only --num-runs 3

# 並列戦略実行
python main_parallel.py --parallel --num-runs 3

# 従来の逐次実行（比較用）
python main.py --strategy swing_trading --num-runs 3
```  
